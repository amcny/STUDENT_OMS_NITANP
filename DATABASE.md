# Data Architecture & Schema Documentation

The **Student Outing Management System** currently utilizes a client-side persistence layer using the browser's **Local Storage** API. This allows the application to function offline and retain data across sessions without a dedicated backend server for this specific deployment version.

## 1. Storage Mechanism

*   **Type:** `window.localStorage` (Key-Value Store)
*   **Format:** JSON Strings
*   **Persistence:** Data remains until explicitly cleared by the user or via browser cache clearing mechanisms.

---

## 2. Data Collections (Schema)

The application partitions data into four primary storage keys.

### A. Students Collection
*   **Storage Key:** `outing_management_students`
*   **Type:** `Array<Student>`
*   **Description:** The master registry of all students enrolled in the system.

| Field | Type | Description | Notes |
| :--- | :--- | :--- | :--- |
| `id` | `UUID (string)` | Unique identifier for the student record. | Generated via `crypto.randomUUID()` |
| `name` | `string` | Full name of the student. | Stored in Uppercase |
| `rollNumber` | `string` | University Roll Number. | Unique constraint handled in UI |
| `registrationNumber` | `string` | Registration Number. | Used for photo mapping |
| `branch` | `string` | Academic Branch (e.g., CSE, ECE). | |
| `year` | `string` | Academic Year (I, II, III, IV). | |
| `gender` | `string` | 'Male' or 'Female'. | Determines Hostel options |
| `studentType` | `string` | 'Hosteller' or 'Day-Scholar'. | |
| `hostel` | `string` | Hostel Name. | Empty if Day-Scholar |
| `roomNumber` | `string` | Room Number. | Empty if Day-Scholar |
| `contactNumber` | `string` | Student's mobile number. | |
| `faceImage` | `Base64 String` | The raw image data of the student's face. | Used for UI display |
| `faceFeatures` | `Array<number>` | 128-dimensional float array. | Generated by `face-api.js` for AI matching |

### B. Outing Logs Collection
*   **Storage Key:** `outing_management_logs`
*   **Type:** `Array<OutingRecord>`
*   **Description:** A transactional history of every student movement (Check-out and Check-in).

| Field | Type | Description | Notes |
| :--- | :--- | :--- | :--- |
| `id` | `UUID (string)` | Unique identifier for the log entry. | |
| `studentId` | `UUID (string)` | Foreign key linking to `students` collection. | |
| `studentName` | `string` | Denormalized name. | For fast display |
| `rollNumber` | `string` | Denormalized roll number. | For searching |
| `year` | `string` | Year at time of outing. | |
| `gender` | `string` | Gender. | |
| `studentType` | `string` | Student Type. | |
| `outingType` | `string` | 'Local' or 'Non-Local'. | Determines overdue logic |
| `checkOutTime` | `ISO Date String` | Timestamp of departure. | |
| `checkOutGate` | `string` | Name of the gate (e.g., 'Front Gate'). | |
| `checkInTime` | `ISO Date String` | Timestamp of return. | `null` if student is currently OUT |
| `checkInGate` | `string` | Name of the gate upon return. | `null` if currently OUT |
| `remarks` | `string` | Optional comments or manual entry notes. | |
| `overdueResolved`| `boolean` | Flag indicating if overdue status was manually cleared. | Optional |

### C. Visitor Logs Collection
*   **Storage Key:** `visitor_management_logs`
*   **Type:** `Array<VisitorPassRecord>`
*   **Description:** Records of visitor gate passes issued.

| Field | Type | Description | Notes |
| :--- | :--- | :--- | :--- |
| `id` | `UUID (string)` | Unique identifier. | |
| `passNumber` | `string` | Generated Pass ID (e.g., V20231025-001). | |
| `date` | `YYYY-MM-DD` | Date of visit. | |
| `name` | `string` | Visitor's Name. | |
| `relation` | `string` | Relation to host (e.g., Parent). | |
| `mobileNumber` | `string` | Visitor's contact. | |
| `address` | `string` | Visitor's address. | |
| `vehicleNumber` | `string` | Vehicle registration (Optional). | |
| `whomToMeet` | `string` | Name of person being visited. | |
| `placeToVisit` | `string` | Location on campus. | |
| `purpose` | `string` | Reason for visit. | |
| `inTime` | `ISO Date String` | Time of entry. | |
| `outTime` | `ISO Date String` | Time of exit. | `null` if still on campus |
| `gateName` | `string` | Entry Gate. | |
| `outGateName` | `string` | Exit Gate. | `null` if still on campus |

### D. Gate Session
*   **Storage Key:** `outing_management_gate`
*   **Type:** `string`
*   **Description:** Stores the name of the currently logged-in gate (e.g., "Front Gate", "Back Gate") to persist session on refresh.

---

## 3. Data Relationships

1.  **One-to-Many (Student -> Outing Logs):**
    *   A single `Student` (identified by `id`) can have multiple `OutingRecord` entries.
    *   The system uses `studentId` in the log to trace back to the student's profile.

2.  **Denormalization Strategy:**
    *   To optimize the `Logbook` view performance and prevent frequent lookups, key student details (`name`, `rollNumber`, `hostel`) are copied into the `OutingRecord` at the moment of creation. This preserves historical accuracy (e.g., if a student changes hostels later, the old log remains accurate to the time it occurred).

---

## 4. System Limits & Scalability

*   **Capacity:** Local Storage is typically limited to **5MB - 10MB** per domain by browsers.
    *   *Implication:* Storing high-resolution Base64 images fills this quickly.
    *   *Optimization:* Images are only stored in the `students` collection. Logs reference the student ID.
*   **Concurrency:** This architecture is designed for a **Single Kiosk** setup per browser instance. Since data is stored locally in the browser, two different computers (Front Gate vs. Back Gate) **do not** share data in real-time in this specific version.
*   **Backup:** The application includes "Export to Excel" features in the Logbook and Visitor sections to allow data archiving and clearing of local storage to free up space.
